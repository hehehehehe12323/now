<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thaw12</title>
  <link rel="icon" type="image/png" sizes="512x512" href="logo.png" />
  <style>
    :root {
      --primary-color: #4f46e5;
      --primary-dark: #3730a3;
      --bg-dark: #1e1e2f;
      --bg-light: #f9f9f9;
      --text-dark: #ffffff;
      --text-light: #1a1a1a;
      --card-bg-dark: #2c2c3e;
      --card-bg-light: #ffffff;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-dark);
      color: var(--text-dark);
      transition: background-color 0.3s, color 0.3s;
    }

    h1, h2, p {
      text-align: center;
      margin: 0.5em 0;
      animation: slideDown 0.8s ease-out forwards;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    .center-button {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1rem;
    }

    .center-button > button,
    .styled-button {
      padding: 10px 15px;
      border-radius: 5px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.3s ease, background-color 0.3s ease;
    }

    .styled-button:hover,
    .center-button > button:hover {
      transform: scale(1.05);
      background-color: var(--primary-dark);
    }

    section {
      animation: fadeIn 1s ease-out forwards;
      margin-top: 40px;
      text-align: center;
    }

    img[alt="ClassroomGMS Logo"] {
      animation: logoIntro 1s ease-out forwards;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-top: 20px;
    }

    #darkModeToggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    #darkModeToggle:hover {
      background-color: var(--primary-dark);
    }

    #searchBar {
      display: block;
      margin: 1.5em auto;
      padding: 12px;
      width: 90%;
      max-width: 600px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      background-color: #333;
      color: #fff;
    }

    #container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .zone-item {
      background-color: var(--card-bg-dark);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .zone-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }

    .zone-item img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .zone-item button {
      width: 100%;
      padding: 12px;
      border: none;
      background-color: var(--primary-color);
      color: white;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .zone-item button:hover {
      background-color: var(--primary-dark);
    }

    #zoneViewer {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 85%;
      height: 85%;
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      z-index: 1000;
      display: none;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      opacity: 0;
    }

    #zoneViewer iframe {
      width: 100%;
      height: 90%;
      border: none;
    }

    #zoneInfo {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #222;
      color: #fff;
    }

    #controls button {
      margin-left: 10px;
      padding: 8px 12px;
      background-color: var(--primary-color);
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }

    #controls button:hover {
      background-color: var(--primary-dark);
    }

    #topControls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin: 20px auto;
      max-width: 1000px;
      padding: 0 20px;
    }

    #dataButtons button,
    #sortOptions {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      font-size: 15px;
      cursor: pointer;
    }

    #dataButtons button {
      background-color: #10b981;
      color: white;
    }

    #dataButtons button:hover {
      background-color: #059669;
    }

    #sortOptions {
      background-color: #fff;
      color: #000;
    }

    .zone-wrapper {
      max-width: 1000px;
      margin: 0 auto;
    }

    .zone-count {
      text-align: center;
      font-size: 18px;
      margin-bottom: 10px;
    }

    body:not(.dark-mode) {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    body:not(.dark-mode) #searchBar {
      background-color: #eee;
      color: #000;
    }

    body:not(.dark-mode) .zone-item {
      background-color: var(--card-bg-light);
      color: #000;
    }

    body:not(.dark-mode) #zoneViewer {
      background-color: #fff;
    }

    body:not(.dark-mode) #zoneInfo {
      background-color: #f0f0f0;
      color: #000;
    }

    /* Animations */
    @keyframes logoIntro {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes slideDown {
      0% { opacity: 0; transform: translateY(-20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes flyInTop {
      from { transform: translate(-50%, -150%); opacity: 0; }
      to { transform: translate(-50%, -50%); opacity: 1; }
    }

    @keyframes flyInBottom {
      from { transform: translate(-50%, 150%); opacity: 0; }
      to { transform: translate(-50%, -50%); opacity: 1; }
    }

    @keyframes flyInLeft {
      from { transform: translate(-150%, -50%); opacity: 0; }
      to { transform: translate(-50%, -50%); opacity: 1; }
    }

    @keyframes flyInRight {
      from { transform: translate(150%, -50%); opacity: 0; }
      to { transform: translate(-50%, -50%); opacity: 1; }
    }

    .fly-in {
      animation-duration: 0.6s;
      animation-fill-mode: both;
      animation-timing-function: ease-out;
    }

    .flyInTop {
      animation-name: flyInTop;
    }

    .flyInBottom {
      animation-name: flyInBottom;
    }

    .flyInLeft {
      animation-name: flyInLeft;
    }

    .flyInRight {
      animation-name: flyInRight;
    }

    @keyframes flyOutTop {
      from { transform: translate(-50%, -50%); opacity: 1; }
      to { transform: translate(-50%, -150%); opacity: 0; }
    }

    @keyframes flyOutBottom {
      from { transform: translate(-50%, -50%); opacity: 1; }
      to { transform: translate(-50%, 150%); opacity: 0; }
    }

    @keyframes flyOutLeft {
      from { transform: translate(-50%, -50%); opacity: 1; }
      to { transform: translate(-150%, -50%); opacity: 0; }
    }

    @keyframes flyOutRight {
      from { transform: translate(-50%, -50%); opacity: 1; }
      to { transform: translate(150%, -50%); opacity: 0; }
    }

    .fly-out {
      animation-duration: 0.6s;
      animation-fill-mode: both;
      animation-timing-function: ease-in;
    }

    .flyOutTop {
      animation-name: flyOutTop;
    }

    .flyOutBottom {
      animation-name: flyOutBottom;
    }

    .flyOutLeft {
      animation-name: flyOutLeft;
    }

    .flyOutRight {
      animation-name: flyOutRight;
    }
  </style>

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://classroomgms.matomo.cloud/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='https://cdn.matomo.cloud/classroomgms.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->
</head>
<body class="dark-mode">

  <div style="position: absolute; top: 20px; left: 20px;">
      <img src="logo.png" alt="ClassroomGMS Logo" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;" />
  </div>

  <h1>ClassroomGS</h1>

  <div class="center-button">
    <a href="mailto:derrick.richard@pothisd.us" target="_blank" rel="noopener noreferrer">
      <button class="styled-button">Contact Derrick for feedback or questions</button>
    </a>
  </div>

  <input type="text" id="searchBar" placeholder="Search Games" onkeyup="filterZones()" />

  <div id="topControls">
    <div id="dataButtons">
      <button onclick="saveData()">Save Data</button>
      <button onclick="document.getElementById('file').click()">Load Data</button>
      <p>Saving data will create a file with all of your save data. When pressing load data, select that file to use your game states.</p>
      <input type="file" id="file" style="display:none" onchange="loadData(event)" />
    </div>
    <select id="sortOptions" onchange="sortZones()">
      <option value="name">by Name</option>
      <option value="id">by Id</option>
      <option value="popular">by Popularity</option>
    </select>
  </div>

  <div class="zone-wrapper">
    <div id="zoneCount" class="zone-count"></div>
    <h2>Game Of The Day</h2>
    <div id="gameOfTheDay" class="game-of-the-day"></div>
    <div id="container">Loading...</div>
  </div>

  <div id="zoneViewer">
    <div id="zoneInfo">
      <div id="zoneTitle">
        <span id="zoneName"></span> <span id="zoneId"></span>
      </div>
      <div id="controls">
        <button onclick="closeZone()">Close</button>
        <button onclick="fullscreenZone()">Fullscreen</button>
        <button onclick="aboutBlank()">about:blank</button>
      </div>
    </div>
    <iframe id="zoneFrame"></iframe>
  </div>

  <button id="darkModeToggle">Toggle Dark Mode</button>

  <footer style="text-align: center; font-size: 14px; padding: 30px 20px; margin-top: 60px; background-color: #111; color: #ccc;">
    <p>
      <a href="https://classroommgs.github.io" style="color: #ccc;">ClassroomMGS</a> Â© 2025 by 
      <a href="https://derrickrichard.github.io/profile/" style="color: #ccc;">Derrick Richard</a> is licensed under 
      <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" style="color: #ccc;">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International</a>
      <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="CC" style="max-width: 1em; max-height: 1em; margin-left: .2em;">
      <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="BY" style="max-width: 1em; max-height: 1em; margin-left: .2em;">
      <img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg" alt="NC" style="max-width: 1em; max-height: 1em; margin-left: .2em;">
      <img src="https://mirrors.creativecommons.org/presskit/icons/nd.svg" alt="ND" style="max-width: 1em; max-height: 1em; margin-left: .2em;">
    </p>
  </footer>

  <script>
    const container = document.getElementById('container');
    const zoneViewer = document.getElementById('zoneViewer');
    let zoneFrame = document.getElementById('zoneFrame');
    const searchBar = document.getElementById('searchBar');
    const sortOptions = document.getElementById('sortOptions');
    const zonesURL = "https://cdn.jsdelivr.net/gh/classroommgs/classroommgs.github.io@main/zones.json";
    const coverURL = "https://cdn.jsdelivr.net/gh/gn-math/covers@main";
    const htmlURL = "https://cdn.jsdelivr.net/gh/gn-math/html@main";

    let zones = [];
    let popularityData = {};

    async function listZones() {
      try {
        const response = await fetch(zonesURL);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        zones = await response.json();
        await fetchPopularity();
        sortZones();
        const search = new URLSearchParams(window.location.search);
        const id = search.get('id');
        if (id) {
          const zone = zones.find(zone => zone.id + '' == id + '');
          if (zone) {
            openZone(zone);
          }
        }
        displayGameOfTheDay();
      } catch (error) {
        container.innerHTML = `Error loading zones: ${error.message}`;
      }
    }

    async function fetchPopularity() {
      try {
        const response = await fetch("https://data.jsdelivr.com/v1/stats/packages/gh/gn-math/html@main/files?period=year");
        const data = await response.json();
        data.forEach(file => {
          const idMatch = file.name.match(/\/(\d+)\.html$/);
          if (idMatch) {
            const id = parseInt(idMatch[1]);
            popularityData[id] = file.hits.total;
          }
        });
      } catch (error) {
        popularityData[0] = 0;
      }
    }

    function sortZones() {
      const sortBy = sortOptions.value;
      if (sortBy === 'name') {
        zones.sort((a, b) => a.name.localeCompare(b.name));
      } else if (sortBy === 'id') {
        zones.sort((a, b) => a.id - b.id);
      } else if (sortBy === 'popular') {
        zones.sort((a, b) => (popularityData[b.id] || 0) - (popularityData[a.id] || 0));
      }
      zones.sort((a, b) => (a.id === -1 ? -1 : b.id === -1 ? 1 : 0));
      displayZones(zones);
      displayGameOfTheDay();
    }

    function displayZones(zonesToDisplay) {
      container.innerHTML = "";
      if (!zonesToDisplay.length) {
        container.innerHTML = "No zones found.";
        return;
      }

      zonesToDisplay.forEach(file => {
        const zoneItem = document.createElement("div");
        zoneItem.className = "zone-item";
        zoneItem.onclick = () => openZone(file);

        const img = document.createElement("img");
        img.src = file.cover.replace("{COVER_URL}", coverURL).replace("{HTML_URL}", htmlURL);
        zoneItem.appendChild(img);

        const button = document.createElement("button");
        button.textContent = file.name;
        button.onclick = (event) => {
          event.stopPropagation();
          openZone(file);
        };
        zoneItem.appendChild(button);

        container.appendChild(zoneItem);
      });
      document.getElementById("zoneCount").textContent = `Total Games: ${zonesToDisplay.length}`;
    }

    function filterZones() {
      const query = searchBar.value.toLowerCase();
      const filteredZones = zones.filter(zone => zone.name.toLowerCase().includes(query));
      displayZones(filteredZones);
    }

    function openZone(file) {
      const directions = ['flyInTop', 'flyInBottom', 'flyInLeft', 'flyInRight'];
      const randomDirection = directions[Math.floor(Math.random() * directions.length)];

      zoneViewer.classList.remove('fly-in', 'flyInTop', 'flyInBottom', 'flyInLeft', 'flyInRight');
      zoneViewer.classList.add('fly-in', randomDirection);

      if (file.url.startsWith("http")) {
        window.location.href = file.url;
      } else {
        const url = file.url.replace("{COVER_URL}", coverURL).replace("{HTML_URL}", htmlURL);
        fetch(url).then(response => response.text()).then(html => {
          if (zoneFrame.contentDocument === null) {
            zoneFrame = document.createElement("iframe");
            zoneFrame.id = "zoneFrame";
            zoneViewer.appendChild(zoneFrame);
          }
          zoneFrame.contentDocument.open();
          zoneFrame.contentDocument.write(html);
          zoneFrame.contentDocument.close();
          document.getElementById('zoneName').textContent = file.name;
          document.getElementById('zoneId').textContent = file.id;
          zoneViewer.style.display = "block";
        }).catch(error => alert("Failed to load zone: " + error));
      }
    }

    function closeZone() {
      const directions = ['flyOutTop', 'flyOutBottom', 'flyOutLeft', 'flyOutRight'];
      const randomDirection = directions[Math.floor(Math.random() * directions.length)];

      zoneViewer.classList.remove('fly-in', 'flyInTop', 'flyInBottom', 'flyInLeft', 'flyInRight');
      zoneViewer.classList.remove('fly-out', 'flyOutTop', 'flyOutBottom', 'flyOutLeft', 'flyOutRight');
      void zoneViewer.offsetWidth; // Force reflow
      zoneViewer.classList.add('fly-out', randomDirection);

      setTimeout(() => {
        zoneViewer.style.display = "none";
        zoneViewer.classList.remove('fly-out', randomDirection);
        zoneViewer.classList.remove('fly-in');
        if (zoneFrame) {
          zoneViewer.removeChild(zoneFrame);
          zoneFrame = document.createElement("iframe");
          zoneFrame.id = "zoneFrame";
          zoneViewer.appendChild(zoneFrame);
        }
      }, 600); // Match animation duration
    }

    function fullscreenZone() {
      if (zoneFrame.requestFullscreen) {
        zoneFrame.requestFullscreen();
      } else if (zoneFrame.mozRequestFullScreen) {
        zoneFrame.mozRequestFullScreen();
      } else if (zoneFrame.webkitRequestFullscreen) {
        zoneFrame.webkitRequestFullscreen();
      } else if (zoneFrame.msRequestFullscreen) {
        zoneFrame.msRequestFullscreen();
      }
    }

    function aboutBlank() {
      const newWindow = window.open("about:blank", "_blank");
      let zone = zones.find(zone => zone.id + '' === document.getElementById('zoneId').textContent).url.replace("{COVER_URL}", coverURL).replace("{HTML_URL}", htmlURL);
      fetch(zone).then(response => response.text()).then(html => {
        if (newWindow) {
          newWindow.document.open();
          newWindow.document.write(html);
          newWindow.document.close();
        }
      });
    }

    function saveData() {
      let data = JSON.stringify(localStorage) + "\n\n|\n\n" + document.cookie;
      const link = document.createElement("a");
      link.href = URL.createObjectURL(new Blob([data], { type: "text/plain" }));
      link.download = `${Date.now()}.data`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function loadData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const content = e.target.result;
        const [localStorageData, cookieData] = content.split("\n\n|\n\n");
        try {
          const parsedData = JSON.parse(localStorageData);
          for (let key in parsedData) {
            localStorage.setItem(key, parsedData[key]);
          }
        } catch (error) {
          console.error(error);
        }
        if (cookieData) {
          const cookies = cookieData.split("; ");
          cookies.forEach(cookie => {
            document.cookie = cookie;
          });
        }
        alert("Data loaded");
      };
      reader.readAsText(file);
    }

    function getGameOfTheDay() {
      if (!zones || zones.length === 0) return null;
      const now = new Date();
      const seed = now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate();
      const index = seed % zones.length;
      return zones[index];
    }

    function displayGameOfTheDay() {
      const game = getGameOfTheDay();
      const container = document.getElementById("container");
      let existing = document.getElementById("gameOfTheDayCard");
      if (existing) existing.remove();

      if (game) {
        const card = document.createElement("div");
        card.id = "gameOfTheDayCard";
        card.className = "zone-item";
        card.style.margin = "0 auto 15px auto";
        card.style.maxWidth = "200px";
        card.style.cursor = "pointer";
        card.onclick = () => openZone(game);

        const img = document.createElement("img");
        img.src = game.cover.replace("{COVER_URL}", coverURL).replace("{HTML_URL}", htmlURL);
        card.appendChild(img);

        const button = document.createElement("button");
        button.textContent = `${game.name}`;
        button.style.width = "100%";
        button.style.textAlign = "center";
        button.onclick = (e) => {
          e.stopPropagation();
          openZone(game);
        };
        card.appendChild(button);

        container.parentNode.insertBefore(card, container);
      }
    }

    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });

    listZones();

    (function () {
      let lastTime = Date.now();
      const threshold = 60000;

      setInterval(() => {
        const currentTime = Date.now();
        if (currentTime - lastTime > threshold) {
          location.reload();
        }
        lastTime = currentTime;
      }, 10000);
    })();

    let hoverTimer;

    // Wait for the DOM to load
    window.addEventListener("DOMContentLoaded", function () {
      const logo = document.querySelector("img[alt='ClassroomGMS Logo']");

      logo.addEventListener("mouseenter", function () {
        hoverTimer = setTimeout(function () {
          alert(" You found the Easter Egg!\n\nYour code is: bRAdEr52\n\nFill out the form linked at the top of the game page to get a shoutout and custom quote on the homepage!");
        }, 6000); // 6 seconds
      });

      logo.addEventListener("mouseleave", function () {
        clearTimeout(hoverTimer);
      });
    });
  </script>
</body>
</html>
